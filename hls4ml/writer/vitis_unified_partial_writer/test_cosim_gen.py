import os

from hls4ml.writer.vitis_unified_writer.meta import VitisUnifiedWriterMeta
from hls4ml.writer.vitis_unified_writer.test_cosim_gen import VitisUnified_TestGen


class VitisUnifiedPartial_TestGen(VitisUnified_TestGen):

    @classmethod
    def write_wrapper_test(self, meta, model, mg):
        inp_gmem_t, out_gmem_t, inps, outs = meta.vitis_unified_config.get_corrected_types()


        filedir = os.path.dirname(os.path.abspath(__file__))
        #### we use the same file as vitis unified
        f = open(os.path.join(filedir, '../../templates/vitis_unified/myproject_test.cpp'))
        fout = open(f'{model.config.get_output_dir()}/{model.config.get_project_name()}_test.cpp', 'w')


        fout.write("//// generated by Vitis Unified Backend\n")

        for line in f.readlines():
            newline = line
            #### TODO we will do it next
            fout.write(newline)